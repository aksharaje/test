"""Add auth models

Revision ID: a4922e39be85
Revises: e8f7a3b2c1d0
Create Date: 2025-12-31 14:57:45.677229

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
import sqlmodel
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'a4922e39be85'
down_revision: Union[str, Sequence[str], None] = 'e8f7a3b2c1d0'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    from sqlalchemy import inspect
    from sqlalchemy.exc import ProgrammingError
    
    # Get connection and inspector
    conn = op.get_bind()
    inspector = inspect(conn)
    existing_tables = inspector.get_table_names()
    
    # Create accounts table if not exists
    if 'accounts' not in existing_tables:
        op.create_table('accounts',
            sa.Column('name', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('id', sa.Integer(), nullable=False),
            sa.Column('owner_id', sa.Integer(), nullable=False),
            sa.Column('created_at', sa.DateTime(), nullable=False),
            sa.Column('updated_at', sa.DateTime(), nullable=False),
            sa.ForeignKeyConstraint(['owner_id'], ['users.id'], ),
            sa.PrimaryKeyConstraint('id')
        )
    
    # Create magic_links table if not exists
    if 'magic_links' not in existing_tables:
        op.create_table('magic_links',
            sa.Column('id', sa.Integer(), nullable=False),
            sa.Column('email', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('token', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('expires_at', sa.DateTime(), nullable=False),
            sa.Column('used', sa.Boolean(), nullable=False),
            sa.Column('created_at', sa.DateTime(), nullable=False),
            sa.PrimaryKeyConstraint('id')
        )
        op.create_index(op.f('ix_magic_links_email'), 'magic_links', ['email'], unique=False)
        op.create_index(op.f('ix_magic_links_token'), 'magic_links', ['token'], unique=True)
    
    # Create account_invites table if not exists
    if 'account_invites' not in existing_tables:
        op.create_table('account_invites',
            sa.Column('id', sa.Integer(), nullable=False),
            sa.Column('email', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('account_id', sa.Integer(), nullable=False),
            sa.Column('token', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('role', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
            sa.Column('status', sa.Enum('PENDING', 'ACCEPTED', 'EXPIRED', name='invitestatus'), nullable=False),
            sa.Column('expires_at', sa.DateTime(), nullable=False),
            sa.Column('created_at', sa.DateTime(), nullable=False),
            sa.ForeignKeyConstraint(['account_id'], ['accounts.id'], ),
            sa.PrimaryKeyConstraint('id')
        )
        op.create_index(op.f('ix_account_invites_token'), 'account_invites', ['token'], unique=True)
    
    # Add columns to users table if they don't exist
    user_columns = [col['name'] for col in inspector.get_columns('users')]
    
    if 'account_id' not in user_columns:
        op.add_column('users', sa.Column('account_id', sa.Integer(), nullable=True))
    if 'role' not in user_columns:
        op.add_column('users', sa.Column('role', sa.Enum('ADMIN', 'MEMBER', name='userrole'), nullable=True))
        # Update existing rows to have a default role
        conn.execute(sa.text("UPDATE users SET role = 'MEMBER' WHERE role IS NULL"))
        op.alter_column('users', 'role', nullable=False)
    if 'is_active' not in user_columns:
        op.add_column('users', sa.Column('is_active', sa.Boolean(), nullable=True))
        conn.execute(sa.text("UPDATE users SET is_active = true WHERE is_active IS NULL"))
        op.alter_column('users', 'is_active', nullable=False)
    if 'full_name' not in user_columns:
        op.add_column('users', sa.Column('full_name', sqlmodel.sql.sqltypes.AutoString(), nullable=True))
    if 'has_accepted_terms' not in user_columns:
        op.add_column('users', sa.Column('has_accepted_terms', sa.Boolean(), nullable=True))
        conn.execute(sa.text("UPDATE users SET has_accepted_terms = false WHERE has_accepted_terms IS NULL"))
        op.alter_column('users', 'has_accepted_terms', nullable=False)
    
    # Add foreign key if not exists (check by trying, ignore error)
    try:
        op.create_foreign_key('fk_users_account_id', 'users', 'accounts', ['account_id'], ['id'])
    except ProgrammingError:
        pass  # FK already exists
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'users', type_='foreignkey')
    op.drop_column('users', 'has_accepted_terms')
    op.drop_column('users', 'full_name')
    op.drop_column('users', 'is_active')
    op.drop_column('users', 'role')
    op.drop_column('users', 'account_id')
    op.create_table('gap_analysis_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('gap_analysis_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('analysis_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('analysis_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('your_journey_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('comparison_journey_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('knowledge_base_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('analysis_parameters', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('overall_assessment', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('competitive_advantages', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('capability_matrix_summary', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('roadmap', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('report_pdf_url', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('raw_llm_response', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['comparison_journey_id'], ['journey_map_sessions.id'], name='gap_analysis_sessions_comparison_journey_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='gap_analysis_sessions_user_id_fkey'),
    sa.ForeignKeyConstraint(['your_journey_id'], ['journey_map_sessions.id'], name='gap_analysis_sessions_your_journey_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='gap_analysis_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('competitive_analysis_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('reference_competitors', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('include_best_in_class', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('include_adjacent_industries', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('industry_standards', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('best_practices', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('common_pitfalls', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('product_gaps', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('opportunities', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('focus_area', sa.VARCHAR(), server_default=sa.text("''::character varying"), autoincrement=False, nullable=False),
    sa.Column('custom_focus_area', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('knowledge_base_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('code_comparison', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('target_industry', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('input_source_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('input_source_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('input_source_description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('focus_area_source_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('focus_area_source_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('focus_area_context', sa.TEXT(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('competitive_analysis_sessions_pkey'))
    )
    op.create_table('generated_presentations',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('audience_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('audience_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('audience_profile', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('presentation_strategy', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('visualization_data', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('narrative', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('talking_points', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('format', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('formatted_content', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['communicator_sessions.id'], name=op.f('generated_presentations_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('generated_presentations_pkey'))
    )
    op.create_table('prioritized_ideas',
    sa.Column('prioritization_session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('generated_idea_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('market_opportunity', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('strategic_opportunity', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('customer_opportunity', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('strategic_fit_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('strategic_fit_rationale', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('tshirt_size', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('size_rationale', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('size_confidence', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('potential_revenue', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('priority_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('priority_tier', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['generated_idea_id'], ['generated_ideas.id'], name=op.f('prioritized_ideas_generated_idea_id_fkey')),
    sa.ForeignKeyConstraint(['prioritization_session_id'], ['prioritization_sessions.id'], name=op.f('prioritized_ideas_prioritization_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('prioritized_ideas_pkey'))
    )
    op.create_index(op.f('ix_prioritized_ideas_prioritization_session_id'), 'prioritized_ideas', ['prioritization_session_id'], unique=False)
    op.create_index(op.f('ix_prioritized_ideas_generated_idea_id'), 'prioritized_ideas', ['generated_idea_id'], unique=False)
    op.create_table('kpi_assignments',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('key_result_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('primary_kpi', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('measurement_unit', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('secondary_kpi', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('check_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('metric_suggestions', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('notes', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('goal_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('goal_title', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('goal_category', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('alternative_kpis', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('rationale', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['key_result_id'], ['okr_key_results.id'], name=op.f('kpi_assignments_key_result_id_fkey')),
    sa.ForeignKeyConstraint(['session_id'], ['kpi_assignment_sessions.id'], name=op.f('kpi_assignments_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('kpi_assignments_pkey'))
    )
    op.create_table('okr_key_results',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('okr_key_results_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('objective_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('metric_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('baseline_value', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('target_value', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('stretch_target', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('measurement_method', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('data_source', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('tracking_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('owner', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('kpi_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['objective_id'], ['okr_objectives.id'], name='okr_key_results_objective_id_fkey'),
    sa.ForeignKeyConstraint(['session_id'], ['okr_sessions.id'], name='okr_key_results_session_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='okr_key_results_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('framework_dashboards',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('audience', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('purpose', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('key_metrics', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('layout_description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('refresh_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('recommended_tool', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('implementation_notes', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['measurement_framework_sessions.id'], name=op.f('framework_dashboards_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('framework_dashboards_pkey'))
    )
    op.create_table('scope_alerts',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('alert_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('severity', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('related_change_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('action_required', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('suggested_action', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('escalation_needed', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_monitor_sessions.id'], name=op.f('scope_alerts_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_alerts_pkey'))
    )
    op.create_table('capability_matrix_items',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('capability_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('your_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('comparison_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('gap_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('your_evidence', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('comparison_evidence', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('improvement_suggestion', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['gap_analysis_sessions.id'], name=op.f('capability_matrix_items_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('capability_matrix_items_pkey'))
    )
    op.create_table('prioritization_sessions',
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('ideation_session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('portfolio_summary', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('processing_time_ms', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['ideation_session_id'], ['ideation_sessions.id'], name=op.f('prioritization_sessions_ideation_session_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('prioritization_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('prioritization_sessions_pkey'))
    )
    op.create_index(op.f('ix_prioritization_sessions_user_id'), 'prioritization_sessions', ['user_id'], unique=False)
    op.create_index(op.f('ix_prioritization_sessions_ideation_session_id'), 'prioritization_sessions', ['ideation_session_id'], unique=False)
    op.create_table('scope_changes',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('change_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('impact_level', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('effort_impact', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('timeline_impact', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('budget_impact', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('is_scope_creep', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('creep_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('justification', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('recommendation', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('recommendation_rationale', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_monitor_sessions.id'], name=op.f('scope_changes_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_changes_pkey'))
    )
    op.create_table('recommendations',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('cluster_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('solution_approaches', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('addresses_pain_points', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('addresses_gaps', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('impact_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('pain_reduction_percent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('users_affected_percent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('business_metrics', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('effort_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('design_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('engineering_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('testing_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('risk_level', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('total_effort_days', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('urgency_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('competitive_context', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('opportunity_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('confidence_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('quick_win', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('priority_tier', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('display_category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('implementation_approach', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('success_metrics', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('epic_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('is_user_edited', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('is_custom', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('is_dismissed', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['epic_id'], ['generated_artifacts.id'], name=op.f('recommendations_epic_id_fkey')),
    sa.ForeignKeyConstraint(['session_id'], ['recommender_sessions.id'], name=op.f('recommendations_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('recommendations_pkey'))
    )
    op.create_table('ado_projects',
    sa.Column('integration_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('ado_id', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('url', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('state', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('synced_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['integration_id'], ['integrations.id'], name=op.f('ado_projects_integration_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('ado_projects_pkey'))
    )
    op.create_table('goal_sessions',
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('company_goals', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('team_charter', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('job_description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('role_responsibilities', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('goal_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='goal_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='goal_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_index(op.f('ix_goal_sessions_user_id'), 'goal_sessions', ['user_id'], unique=False)
    op.create_table('scenario_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('scenario_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('roadmap_session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('baseline_snapshot', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_total', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('total_variants', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('viable_variants', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['roadmap_session_id'], ['roadmap_sessions.id'], name='scenario_sessions_roadmap_session_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='scenario_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='scenario_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('gap_items',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('stage_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('stage_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('impact_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('urgency_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('effort_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('opportunity_score', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=False),
    sa.Column('priority_tier', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('evidence', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('comparison_notes', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('roi_projection', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_user_edited', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('user_priority_override', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['gap_analysis_sessions.id'], name=op.f('gap_items_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('gap_items_pkey'))
    )
    op.create_table('stage_alignments',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('your_stage_id', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('your_stage_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('comparison_stage_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('comparison_stage_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('alignment_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('gaps_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('critical_gaps_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('advantages_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['gap_analysis_sessions.id'], name=op.f('stage_alignments_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('stage_alignments_pkey'))
    )
    op.create_table('scope_monitor_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('scope_monitor_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('project_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('baseline_scope_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('baseline_description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('current_requirements', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('change_context', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('scope_health_score', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('creep_risk_level', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('recommendations', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['baseline_scope_id'], ['scope_definition_sessions.id'], name='scope_monitor_sessions_baseline_scope_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='scope_monitor_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='scope_monitor_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('okr_objectives',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('okr_objectives_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('timeframe', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('strategic_alignment', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('owner', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['okr_sessions.id'], name='okr_objectives_session_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='okr_objectives_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('scope_definition_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('scope_definition_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('project_name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('product_vision', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('initial_requirements', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('known_constraints', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('stakeholder_needs', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('target_users', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('scope_statement', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('ideation_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('okr_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('knowledge_base_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['ideation_session_id'], ['ideation_sessions.id'], name='scope_definition_sessions_ideation_session_id_fkey'),
    sa.ForeignKeyConstraint(['okr_session_id'], ['okr_sessions.id'], name='scope_definition_sessions_okr_session_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='scope_definition_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='scope_definition_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('story_to_code_sessions',
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('input_source', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('input_description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('source_artifact_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('tech_stack', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('knowledge_base_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('generated_files', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['source_artifact_id'], ['generated_artifacts.id'], name=op.f('story_to_code_sessions_source_artifact_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('story_to_code_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('story_to_code_sessions_pkey'))
    )
    op.create_table('goal_setting_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('goal_setting_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('domain', sa.VARCHAR(), server_default=sa.text("''::character varying"), autoincrement=False, nullable=False),
    sa.Column('strategy', sa.VARCHAR(), server_default=sa.text("''::character varying"), autoincrement=False, nullable=False),
    sa.Column('team_charter', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('problem_statements', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('baselines', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='goal_setting_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='goal_setting_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('communicator_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('roadmap_session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('scenario_variant_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('source_snapshot', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_total', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('total_presentations', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['roadmap_session_id'], ['roadmap_sessions.id'], name=op.f('communicator_sessions_roadmap_session_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('communicator_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('communicator_sessions_pkey'))
    )
    op.create_table('scope_constraints',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('constraint', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('impact', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('flexibility', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('mitigation_strategy', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_definition_sessions.id'], name=op.f('scope_constraints_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_constraints_pkey'))
    )
    op.create_table('user_goals',
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('specific', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('measurable', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('achievable', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('relevant', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('time_bound', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('priority', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_notes', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('completion_percentage', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['goal_sessions.id'], name=op.f('user_goals_session_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('user_goals_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('user_goals_pkey'))
    )
    op.create_index(op.f('ix_user_goals_user_id'), 'user_goals', ['user_id'], unique=False)
    op.create_index(op.f('ix_user_goals_session_id'), 'user_goals', ['session_id'], unique=False)
    op.create_table('market_research_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('problem_area', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('industry_context', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('focus_areas', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('market_trends', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('expectation_shifts', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('market_risks', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('implications', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('problem_area_source_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('problem_area_source_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('problem_area_context', sa.TEXT(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('market_research_sessions_pkey'))
    )
    op.create_table('scope_impact_assessments',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('area', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('baseline_value', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('current_value', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('projected_value', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('impact_description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('impact_severity', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('mitigation_options', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('recommended_action', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_monitor_sessions.id'], name=op.f('scope_impact_assessments_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_impact_assessments_pkey'))
    )
    op.create_table('okr_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('okr_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('goal_description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('goal_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('timeframe', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('team_context', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('measurement_preferences', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['goal_session_id'], ['goal_setting_sessions.id'], name='okr_sessions_goal_session_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='okr_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='okr_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('framework_metrics',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('metric_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('data_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('formula', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('unit', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('baseline', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('target', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('threshold_good', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('threshold_warning', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('threshold_critical', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('collection_method', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('collection_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('data_owner', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('data_source', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('visualization_type', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('dashboard_placement', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['measurement_framework_sessions.id'], name=op.f('framework_metrics_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('framework_metrics_pkey'))
    )
    op.create_table('recommender_input_cache',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('extracted_pain_points', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('extracted_gaps', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('extracted_ideas', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('total_pain_points', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('total_gaps', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('total_ideas', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['recommender_sessions.id'], name=op.f('recommender_input_cache_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('recommender_input_cache_pkey'))
    )
    op.create_table('recommender_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('session_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('journey_map_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('gap_analysis_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('idea_backlog_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('timeline', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('budget', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('team_capacity', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('recommendation_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('total_recommendations', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('quick_wins_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('high_impact_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('strategic_count', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('clusters', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('sprint_plan', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('raw_llm_responses', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('recommender_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('recommender_sessions_pkey'))
    )
    op.create_table('useractivity',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('feature_key', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('timestamp', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('metadata_json', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('useractivity_pkey'))
    )
    op.create_index(op.f('ix_useractivity_user_id'), 'useractivity', ['user_id'], unique=False)
    op.create_index(op.f('ix_useractivity_feature_key'), 'useractivity', ['feature_key'], unique=False)
    op.create_table('scope_items',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('scope_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('priority', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('rationale', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('estimated_complexity', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('dependencies', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_definition_sessions.id'], name=op.f('scope_items_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_items_pkey'))
    )
    op.create_table('okr_kpis',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('key_result_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('metric_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('formula', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('baseline', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('target', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('unit', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('data_source', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('collection_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('owner', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['key_result_id'], ['okr_key_results.id'], name=op.f('okr_kpis_key_result_id_fkey')),
    sa.ForeignKeyConstraint(['session_id'], ['okr_sessions.id'], name=op.f('okr_kpis_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('okr_kpis_pkey'))
    )
    op.create_table('tracked_work_items',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('external_id', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('external_url', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('item_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.TEXT(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('status_category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('assignee', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('assignee_email', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('sprint_name', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('sprint_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('story_points', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('original_estimate', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('time_spent', sa.DOUBLE_PRECISION(precision=53), autoincrement=False, nullable=True),
    sa.Column('priority', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('priority_order', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('labels', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('components', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('parent_id', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('parent_title', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('blocker_signals', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('blocker_confidence', sa.DOUBLE_PRECISION(precision=53), server_default=sa.text("'0'::double precision"), autoincrement=False, nullable=False),
    sa.Column('is_blocked', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False),
    sa.Column('blocker_reason', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('links', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('last_updated_external', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('days_in_status', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('raw_data', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('synced_at', postgresql.TIMESTAMP(), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['progress_tracker_sessions.id'], name=op.f('tracked_work_items_session_id_fkey'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('tracked_work_items_pkey'))
    )
    op.create_index(op.f('ix_tracked_work_items_session_id'), 'tracked_work_items', ['session_id'], unique=False)
    op.create_index(op.f('ix_tracked_work_items_is_blocked'), 'tracked_work_items', ['is_blocked'], unique=False)
    op.create_index(op.f('ix_tracked_work_items_external_id'), 'tracked_work_items', ['external_id'], unique=False)
    op.create_table('scenario_variants',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('is_baseline', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('variable_changes', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('generated_roadmap', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('impact_summary', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('risk_score', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('risk_factors', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('trade_offs', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('is_viable', sa.BOOLEAN(), autoincrement=False, nullable=False),
    sa.Column('non_viable_reason', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scenario_sessions.id'], name=op.f('scenario_variants_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scenario_variants_pkey'))
    )
    op.create_table('scope_assumptions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('assumption', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('risk_if_wrong', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('validation_method', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('confidence', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_definition_sessions.id'], name=op.f('scope_assumptions_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_assumptions_pkey'))
    )
    op.create_table('measurement_framework_sessions',
    sa.Column('id', sa.INTEGER(), server_default=sa.text("nextval('measurement_framework_sessions_id_seq'::regclass)"), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('objectives_description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('okr_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('existing_data_sources', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('reporting_requirements', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('stakeholder_audience', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('framework_overview', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('knowledge_base_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['okr_session_id'], ['okr_sessions.id'], name='measurement_framework_sessions_okr_session_id_fkey'),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name='measurement_framework_sessions_user_id_fkey'),
    sa.PrimaryKeyConstraint('id', name='measurement_framework_sessions_pkey'),
    postgresql_ignore_search_path=False
    )
    op.create_table('scope_deliverables',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('acceptance_criteria', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('target_milestone', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('estimated_completion', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('dependencies', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['scope_definition_sessions.id'], name=op.f('scope_deliverables_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('scope_deliverables_pkey'))
    )
    op.create_table('kpi_assignment_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('okr_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.Column('completed_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('goal_session_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('executive_summary', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('generation_metadata', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.ForeignKeyConstraint(['okr_session_id'], ['okr_sessions.id'], name=op.f('kpi_assignment_sessions_okr_session_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('kpi_assignment_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('kpi_assignment_sessions_pkey'))
    )
    op.create_table('framework_data_sources',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('source_type', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('connection_details', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('refresh_frequency', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('reliability_score', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('data_quality_notes', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('linked_metric_ids', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['measurement_framework_sessions.id'], name=op.f('framework_data_sources_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('framework_data_sources_pkey'))
    )
    op.create_table('progress_tracker_sessions',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('user_id', sa.INTEGER(), autoincrement=False, nullable=True),
    sa.Column('integration_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('name', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('template_id', sa.VARCHAR(), server_default=sa.text("'basic'::character varying"), autoincrement=False, nullable=False),
    sa.Column('sprint_filter', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('blocker_config', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('sync_config', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('status', sa.VARCHAR(), server_default=sa.text("'draft'::character varying"), autoincrement=False, nullable=False),
    sa.Column('progress_step', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('progress_total', sa.INTEGER(), server_default=sa.text('3'), autoincrement=False, nullable=False),
    sa.Column('progress_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('error_message', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('metrics_snapshot', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('last_sync_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=True),
    sa.Column('items_synced', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('blockers_detected', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.Column('updated_at', postgresql.TIMESTAMP(), server_default=sa.text('now()'), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['integration_id'], ['integrations.id'], name=op.f('progress_tracker_sessions_integration_id_fkey')),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], name=op.f('progress_tracker_sessions_user_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('progress_tracker_sessions_pkey'))
    )
    op.create_index(op.f('ix_progress_tracker_sessions_user_id'), 'progress_tracker_sessions', ['user_id'], unique=False)
    op.create_index(op.f('ix_progress_tracker_sessions_integration_id'), 'progress_tracker_sessions', ['integration_id'], unique=False)
    op.create_table('goals',
    sa.Column('id', sa.INTEGER(), autoincrement=True, nullable=False),
    sa.Column('session_id', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('title', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('description', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('category', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('timeframe', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('specific', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('measurable', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('achievable', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('relevant', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('time_bound', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('success_criteria', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('dependencies', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('risks', postgresql.JSON(astext_type=sa.Text()), autoincrement=False, nullable=True),
    sa.Column('priority', sa.VARCHAR(), autoincrement=False, nullable=False),
    sa.Column('estimated_effort', sa.VARCHAR(), autoincrement=False, nullable=True),
    sa.Column('display_order', sa.INTEGER(), autoincrement=False, nullable=False),
    sa.Column('created_at', postgresql.TIMESTAMP(), autoincrement=False, nullable=False),
    sa.ForeignKeyConstraint(['session_id'], ['goal_setting_sessions.id'], name=op.f('goals_session_id_fkey')),
    sa.PrimaryKeyConstraint('id', name=op.f('goals_pkey'))
    )
    op.drop_index(op.f('ix_account_invites_token'), table_name='account_invites')
    op.drop_table('account_invites')
    op.drop_index(op.f('ix_magic_links_token'), table_name='magic_links')
    op.drop_index(op.f('ix_magic_links_email'), table_name='magic_links')
    op.drop_table('magic_links')
    op.drop_table('accounts')
    # ### end Alembic commands ###
