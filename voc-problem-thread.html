<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Thread - Voice of Customer</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        .container-centered {
            max-width: 900px;
            margin: 0 auto;
            display: block !important;
        }

        .thread-header-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .meta-row {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* Evidence Summary */
        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .evidence-stat {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
        }

        .evidence-stat .count {
            display: block;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .evidence-stat .label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Feedback List */
        .feedback-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .feedback-item {
            background: #F8FAFC;
            border-radius: var(--radius-md);
            padding: 12px 16px;
            font-size: 14px;
            color: var(--text-primary);
            border-left: 3px solid var(--border-color);
            display: flex;
            gap: 12px;
        }

        .confidence-box {
            background: #F0FDF4;
            border: 1px solid #BBF7D0;
            border-radius: var(--radius-md);
            padding: 16px;
        }

        .question-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #F1F5F9;
        }

        .question-item:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <div class="app-container container-centered">
        <!-- Header -->
        <header class="app-header">
            <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                <button class="btn btn-outline-sm" onclick="window.location.href='discovery-hub.html'"><i
                        class="ph ph-arrow-left"></i> Back to Discovery</button>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-outline-sm" style="color: #ef4444; border-color: #ef4444;"
                        onclick="deleteThread()">
                        <i class="ph ph-trash"></i> Delete
                    </button>
                    <button class="btn btn-outline-sm" onclick="alert('Skipping...')">Skip to Solution Design</button>
                </div>
            </div>

            <div class="thread-header-card">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <h1 style="font-size: 20px; margin-bottom: 8px;" id="thread-title">Loading...</h1>
                    <div class="confidence-badge" id="thread-confidence">Confidence</div>
                </div>

                <div class="form-group" style="margin-bottom: 0;">
                    <label style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em;">Problem
                        Statement</label>
                    <textarea style="font-weight: 500; font-size: 15px; resize: none; background: #F8FAFC;" rows="2"
                        id="thread-statement"></textarea>
                </div>

                <div class="meta-row">
                    <span><i class="ph ph-check-circle"></i> Status: <strong
                            id="thread-status">Understood</strong></span>
                    <span><i class="ph ph-target"></i> Scope: <strong>In Scope</strong></span>
                    <span><i class="ph ph-clock"></i> Last updated: Today</span>
                </div>
            </div>
        </header>

        <main>
            <!-- Evidence Summary -->
            <h3 class="section-header">Evidence Summary</h3>
            <div class="evidence-grid">
                <div class="evidence-stat">
                    <span class="count" id="count-client">0</span>
                    <span class="label">Client Conversations</span>
                </div>
                <div class="evidence-stat">
                    <span class="count" id="count-sales">0</span>
                    <span class="label">Sales / CS Notes</span>
                </div>
                <div class="evidence-stat">
                    <span class="count" id="count-support">0</span>
                    <span class="label">Support Tickets</span>
                </div>
                <div class="evidence-stat">
                    <span class="count" id="count-analytics">0</span>
                    <span class="label">Analytics Signals</span>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 32px;">
                <!-- Left Col -->
                <div>
                    <h3 class="section-header">Voice of Customer Evidence</h3>
                    <div class="feedback-list" id="feedback-list">
                        <!-- Populated by JS -->
                    </div>

                    <h3 class="section-header" style="margin-top: 32px;">Confidence Breakdown</h3>
                    <div class="confidence-box">
                        <h4 style="font-size: 14px; margin-bottom: 12px;" id="conf-reason-title">Why Confidence is HIGH
                        </h4>
                        <ul class="confidence-list" id="conf-list">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>

                <!-- Right Col -->
                <div>
                    <h3 class="section-header">Open Questions</h3>
                    <div class="summary-card" style="padding: 16px;">
                        <div id="questions-list">
                            <!-- Populated by JS -->
                        </div>
                        <button class="btn btn-dashed" style="margin-top: 12px; padding: 8px; font-size: 12px;">+ Add
                            Question</button>
                    </div>

                    <h3 class="section-header" style="margin-top: 32px;">Next Actions</h3>
                    <div class="summary-card" style="padding: 16px;">
                        <div class="checkbox-group" style="flex-direction: column; gap: 12px; margin-bottom: 20px;">
                            <label class="checkbox-pill checked"><input type="checkbox" checked> Propose
                                solution</label>
                            <label class="checkbox-pill checked"><input type="checkbox" checked> Validate with
                                client</label>
                            <label class="checkbox-pill"><input type="checkbox"> Deprioritize</label>
                            <label class="checkbox-pill"><input type="checkbox"> Escalate (scope impact)</label>
                        </div>
                        <button class="btn btn-primary full-width"
                            onclick="alert('Proceeding to Solution Design')">Continue to Solution Design</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const mockData = {
            'login': {
                title: "Login Error Confusion",
                statement: "Users do not understand what went wrong when login fails, leading to repeated retries or abandonment—especially on mobile.",
                status: "Understood",
                confidence: "High",
                confClass: "conf-high",
                counts: { client: 3, sales: 1, support: 27, analytics: 2 },
                feedback: [
                    "Users don’t know what ‘invalid credentials’ means.",
                    "They keep retrying instead of resetting password.",
                    "Issue seems worse on mobile devices."
                ],
                confReasons: [
                    "Repeated client feedback",
                    "High volume of support tickets",
                    "Analytics confirms behavioral drop-off",
                    "Consistent pattern across sources"
                ],
                questions: [
                    "Is this primarily affecting new users?",
                    "Are password rules unclear?",
                    "Does mobile latency contribute?"
                ]
            },
            'onboarding': {
                title: "Onboarding Takes Too Long",
                statement: "New users are dropping off during step 4 of 6 because the 'Team Invite' step is mandatory but often irrelevant at that stage.",
                status: "Validation",
                confidence: "High",
                confClass: "conf-high",
                counts: { client: 5, sales: 3, support: 12, analytics: 1 },
                feedback: [
                    "I just want to see the dashboard, why do I have to invite people first?",
                    "Clients complain that they don't have team emails ready during setup.",
                    "Sales teams say this adds friction to demos."
                ],
                confReasons: [
                    "Direct correlation between step 4 and drop-off",
                    "Validated by Sales team observations",
                    "Multiple client complaints during QBRs"
                ],
                questions: [
                    "Can we make this step optional?",
                    "Is this required for billing?",
                    "Do we need a 'Skip for now' button?"
                ]
            },
            'password': {
                title: "Password Reset Delays",
                statement: "Reset emails are taking >5 minutes to arrive for enterprise domains, causing support ticket spikes on Monday mornings.",
                status: "Investigating",
                confidence: "Improving",
                confClass: "conf-medium", // Using medium for green/improving style override logic
                forceColor: "#10B981",
                counts: { client: 1, sales: 0, support: 42, analytics: 0 },
                feedback: [
                    "IT admins are blocking our emails.",
                    "Users click 'Resend' 5 times because it doesn't come instantly.",
                    "Support is flooded with 'I can't log in' tickets."
                ],
                confReasons: [
                    "Support ticket volume is the primary signal",
                    "Lack of analytics visibility into email delivery",
                    "Engineering investigating SMTP logs"
                ],
                questions: [
                    "Is this an SendGrid issue?",
                    "Are we being rate limited?",
                    "Does this affect Gmail/Outlook users too?"
                ]
            }
        };

        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id') || 'login';
        }

        function render() {
            const id = getParams();
            let data = mockData[id];

            if (!data) {
                // Try to find in local storage
                const threads = JSON.parse(localStorage.getItem('voc_threads') || '[]');
                data = threads.find(t => t.id === id);
            }

            if (!data) data = mockData['login']; // Fallback

            document.getElementById('thread-title').textContent = data.title;
            document.getElementById('thread-statement').value = data.statement;
            document.getElementById('thread-status').textContent = data.status;

            const badge = document.getElementById('thread-confidence');
            badge.textContent = data.confidence + ' Confidence';
            badge.className = 'confidence-badge ' + data.confClass;
            if (data.forceColor) {
                badge.style.backgroundColor = '#ECFDF5';
                badge.style.color = data.forceColor;
            } else {
                badge.style.backgroundColor = '';
                badge.style.color = '';
            }

            // Counts
            document.getElementById('count-client').textContent = data.counts.client;
            document.getElementById('count-sales').textContent = data.counts.sales;
            document.getElementById('count-support').textContent = data.counts.support;
            document.getElementById('count-analytics').textContent = data.counts.analytics;

            // Feedback
            let feedback = [...data.feedback];
            const updates = JSON.parse(localStorage.getItem('voc_updates') || '{}');
            if (updates[id]) {
                // If we have saved updates for this thread ID, prepend them
                // Reverse to show newest at top if desirable, or keep order
                const newItems = updates[id].map(u => u.text).reverse();
                feedback = [...newItems, ...feedback];
            }

            const feedList = document.getElementById('feedback-list');
            feedList.innerHTML = feedback.map(f => `
                <div class="feedback-item">
                    <i class="ph ph-quotes" style="color: var(--text-secondary);"></i>
                    "${f}"
                </div>
            `).join('');

            // Confidence Reasons
            document.getElementById('conf-reason-title').textContent = `Why Confidence is ${data.confidence.toUpperCase()}`;
            if (data.forceColor) document.getElementById('conf-reason-title').style.color = data.forceColor;

            document.getElementById('conf-list').innerHTML = data.confReasons.map(r => `
                <li><i class="ph ph-check-circle"></i> ${r}</li>
            `).join('');

            // Questions
            document.getElementById('questions-list').innerHTML = data.questions.map(q => `
                <div class="question-item">
                    <input type="checkbox"> <span>${q}</span>
                </div>
            `).join('');
        }

        function deleteThread() {
            const id = getParams();

            if (mockData[id]) {
                alert("You cannot delete the default demo threads.");
                return;
            }

            if (confirm("Are you sure you want to delete this problem thread? This action cannot be undone.")) {
                const threads = JSON.parse(localStorage.getItem('voc_threads') || '[]');
                const newThreads = threads.filter(t => t.id !== id);
                localStorage.setItem('voc_threads', JSON.stringify(newThreads));

                // Optional: Cleanup updates for this thread
                const updates = JSON.parse(localStorage.getItem('voc_updates') || '{}');
                delete updates[id];
                localStorage.setItem('voc_updates', JSON.stringify(updates));

                alert("Thread deleted.");
                window.location.href = 'discovery-hub.html';
            }
        }

        render();
    </script>
</body>

</html>